{% extends "layout.html" %}

{% block title %}íšŒì› ìƒì„¸ - {{ user.username }}{% endblock %}

{% block content %}
<div class="header">
    <h1>ğŸ‘¤ íšŒì› ìƒì„¸ ì •ë³´</h1>
    <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">â† ëª©ë¡ìœ¼ë¡œ</a>
</div>

<!-- íšŒì› ê¸°ë³¸ ì •ë³´ -->
<div class="card">
    <h3>ê¸°ë³¸ ì •ë³´</h3>
    <table style="width: 100%;">
        <tr>
            <td style="padding: 10px; color: #888; width: 150px;">ID</td>
            <td style="padding: 10px;">{{ user.id }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; color: #888;">ì´ë¦„</td>
            <td style="padding: 10px;">{{ user.username }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; color: #888;">ì´ë©”ì¼</td>
            <td style="padding: 10px;">{{ user.email }}</td>
        </tr>
        <tr>
            <td style="padding: 10px; color: #888;">ê°€ì…ì¼</td>
            <td style="padding: 10px;">
                {% if user.created_at %}
                {{ user.created_at.strftime('%Y-%m-%d %H:%M') }}
                {% else %}
                -
                {% endif %}
            </td>
        </tr>
        <tr>
            <td style="padding: 10px; color: #888;">ìµœê·¼ ë¡œê·¸ì¸</td>
            <td style="padding: 10px;">
                {% if user.last_login %}
                {{ user.last_login.strftime('%Y-%m-%d %H:%M') }}
                {% else %}
                -
                {% endif %}
            </td>
        </tr>
    </table>
</div>

<!-- ì›” ì„ íƒ í•„í„° -->
<div class="card mt-4">
    <h3>ğŸ“Š ê¸°ê°„ë³„ í†µê³„</h3>
    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
        <a href="{{ url_for('admin_user_detail', user_id=user.id) }}" 
           class="btn {% if not selected_month %}btn-primary{% else %}btn-secondary{% endif %}">
            ì „ì²´
        </a>
        {% for month in available_months %}
        <a href="{{ url_for('admin_user_detail', user_id=user.id, month=month) }}" 
           class="btn {% if selected_month == month %}btn-primary{% else %}btn-secondary{% endif %}">
            {{ month }}
        </a>
        {% endfor %}
    </div>
    
    <!-- í†µê³„ ì¹´ë“œ -->
    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 150px; text-align: center; background: #1a1a2e; padding: 20px; border-radius: 10px;">
            <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì´ ì§€ì¶œ</h4>
            <p style="font-size: 1.5em; margin: 10px 0; color: #ff6b6b;">{{ "{:,}".format(total_expense) }}ì›</p>
        </div>
        <div style="flex: 1; min-width: 150px; text-align: center; background: #1a1a2e; padding: 20px; border-radius: 10px;">
            <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì´ ë§¤ì¶œ</h4>
            <p style="font-size: 1.5em; margin: 10px 0; color: #ffd93d;">{{ "{:,}".format(total_sales) }}ì›</p>
        </div>
        <div style="flex: 1; min-width: 150px; text-align: center; background: #1a1a2e; padding: 20px; border-radius: 10px;">
            <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì´ ìˆœì´ìµ</h4>
            <p style="font-size: 1.5em; margin: 10px 0; color: {% if total_profit >= 0 %}#6BCB77{% else %}#ff6b6b{% endif %};">{{ "{:,}".format(total_profit) }}ì›</p>
        </div>
    </div>
</div>

<!-- ì†Œì† ì‚¬ì—…ì¥ -->
<div class="card mt-4">
    <h3>ì†Œì† ì‚¬ì—…ì¥ ({{ workspaces|length }}ê°œ) {% if selected_month %}<span style="color: #888; font-size: 0.8em;">- {{ selected_month }} ê¸°ì¤€</span>{% endif %}</h3>
    
    {% if workspaces %}
    <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #444;">
                <th style="padding: 12px; text-align: left;">ID</th>
                <th style="padding: 12px; text-align: left;">ì‚¬ì—…ì¥ëª…</th>
                <th style="padding: 12px; text-align: center;">ì—­í• </th>
                <th style="padding: 12px; text-align: right;">ì§€ì¶œ</th>
                <th style="padding: 12px; text-align: right;">ë§¤ì¶œ</th>
                <th style="padding: 12px; text-align: right;">ìˆœì´ìµ</th>
            </tr>
        </thead>
        <tbody>
            {% for ws in workspaces %}
            <tr style="border-bottom: 1px solid #333;">
                <td style="padding: 12px;">{{ ws.id }}</td>
                <td style="padding: 12px;">{{ ws.name }}</td>
                <td style="padding: 12px; text-align: center;">
                    {% if ws.role == 'owner' %}
                    <span style="background: #4CAF50; padding: 3px 10px; border-radius: 3px;">ì†Œìœ ì</span>
                    {% elif ws.role == 'admin' %}
                    <span style="background: #2196F3; padding: 3px 10px; border-radius: 3px;">ê´€ë¦¬ì</span>
                    {% else %}
                    <span style="background: #666; padding: 3px 10px; border-radius: 3px;">ë©¤ë²„</span>
                    {% endif %}
                </td>
                <td style="padding: 12px; text-align: right; color: #ff6b6b;">{{ "{:,}".format(ws.expense) }}</td>
                <td style="padding: 12px; text-align: right; color: #ffd93d;">{{ "{:,}".format(ws.sales) }}</td>
                <td style="padding: 12px; text-align: right; color: {% if ws.profit >= 0 %}#6BCB77{% else %}#ff6b6b{% endif %};">{{ "{:,}".format(ws.profit) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    {% else %}
    <p style="color: #888; text-align: center; padding: 20px;">ì†Œì†ëœ ì‚¬ì—…ì¥ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
</div>

<!-- ìœ„í—˜ ì˜ì—­ -->
<div class="card mt-4" style="border: 1px solid #ff5555;">
    <h3 style="color: #ff5555;">âš ï¸ ìœ„í—˜ ì˜ì—­</h3>
    <p style="color: #888; margin-bottom: 15px;">íšŒì›ì„ ì‚­ì œí•˜ë©´ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    <form action="{{ url_for('admin_delete_user', user_id=user.id) }}" method="post" onsubmit="return confirm('ì •ë§ ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\níšŒì›: {{ user.username }}\nì´ë©”ì¼: {{ user.email }}\n\nâš ï¸ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');">
        <button type="submit" class="btn btn-danger">íšŒì› ì‚­ì œ</button>
    </form>
</div>
{% endblock %}