{% extends "layout.html" %}

{% block title %}멤버 관리{% endblock %}

{% block content %}
<div class="header" style="display: flex; justify-content: space-between; align-items: flex-start;">
    <div>
        <h1>멤버 관리</h1>
        <p><strong>{{ workspace.name }}</strong> 사업장의 멤버를 관리하고 초대합니다.</p>
    </div>
    <div>
        <a href="{{ url_for('manage_workspaces') }}" class="btn btn-secondary">사업장 목록으로</a>
    </div>
</div>

<!-- 새 멤버 초대 (owner, admin만 보임) -->
{% if current_user_role in ['owner', 'admin'] %}
<div class="card">
    <h3>새 멤버 초대</h3>
    <form method="POST" action="{{ url_for('manage_members', workspace_id=workspace.id) }}" class="simple-form">
        <div class="form-row">
            <label for="email">이메일</label>
            <input type="email" name="email" id="email" placeholder="초대할 직원의 이메일 주소" required>
        </div>
        <div class="form-row">
            <label for="role">역할</label>
            <select name="role" id="role" class="form-control" style="flex-grow: 1; background-color: #3e3e3e; border: 1px solid #555; color: #fff; padding: 8px 12px; border-radius: 4px;">
                <option value="member">직원 (Member)</option>
                <option value="admin">관리자 (Admin)</option>
                {% if current_user_role == 'owner' %}
                <option value="owner">대표 (Owner)</option>
                {% endif %}
            </select>
        </div>
        <button type="submit" class="btn btn-primary">멤버 초대</button>
    </form>
</div>
{% endif %}


<!-- 멤버 목록 -->
<div class="card mt-4">
    <h3>멤버 목록</h3>
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>사용자명</th>
                    <th>이메일</th>
                    <th>역할</th>
                    <th style="text-align: right;">관리</th>
                </tr>
            </thead>
            <tbody>
                {% for member_assoc in members %}
                <tr>
                    <td><strong>{{ member_assoc.user.username }}</strong></td>
                    <td>{{ member_assoc.user.email }}</td>
                    <td>
                        <span class="badge" style="background-color: {% if member_assoc.role == 'owner' %}#6f42c1{% elif member_assoc.role == 'admin' %}#00a6da{% else %}#555{% endif %}; color: white; padding: 6px 10px; border-radius: 15px;">
                            {{ member_assoc.role }}
                        </span>
                    </td>
                    <td style="text-align: right; white-space: nowrap; display: flex; justify-content: flex-end; gap: 8px;">
                        {% if current_user_role in ['owner', 'admin'] and member_assoc.user.id != current_user.id %}
                            {# ⭐️⭐️⭐️ '권한 설정' 버튼이 추가되었습니다 ⭐️⭐️⭐️ #}
                            <a href="{{ url_for('manage_permissions', workspace_id=workspace.id, user_id=member_assoc.user.id) }}" class="btn btn-primary btn-sm">권한 설정</a>
                            
                            <form method="POST" action="{{ url_for('delete_member', workspace_id=workspace.id, user_id=member_assoc.user.id) }}" onsubmit="return confirm('정말 이 멤버를 삭제하시겠습니까?');">
                                <button type="submit" class="btn btn-danger btn-sm">삭제</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="4" style="text-align: center; padding: 20px;">이 사업장에는 아직 멤버가 없습니다.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

