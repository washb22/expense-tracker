{% extends "layout.html" %}

{% block title %}ê´€ë¦¬ì í˜ì´ì§€{% endblock %}

{% block content %}
<div class="header">
    <h1>ğŸ” ìŠˆí¼ ê´€ë¦¬ì í˜ì´ì§€</h1>
    <p>ì „ì²´ íšŒì› ë° ì‚¬ì—…ì¥ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
</div>

<!-- ì „ì²´ í†µê³„ ì¹´ë“œ -->
<div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
    <div class="card" style="flex: 1; min-width: 150px; text-align: center;">
        <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì „ì²´ íšŒì›</h4>
        <p style="font-size: 2em; margin: 10px 0; color: #4CAF50;">{{ total_users }}</p>
    </div>
    <div class="card" style="flex: 1; min-width: 150px; text-align: center;">
        <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì „ì²´ ì‚¬ì—…ì¥</h4>
        <p style="font-size: 2em; margin: 10px 0; color: #2196F3;">{{ total_workspaces }}</p>
    </div>
    <div class="card" style="flex: 1; min-width: 150px; text-align: center;">
        <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì „ì²´ ì§€ì¶œ</h4>
        <p style="font-size: 1.5em; margin: 10px 0; color: #ff6b6b;">{{ "{:,}".format(total_expense) }}ì›</p>
    </div>
    <div class="card" style="flex: 1; min-width: 150px; text-align: center;">
        <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì „ì²´ ë§¤ì¶œ</h4>
        <p style="font-size: 1.5em; margin: 10px 0; color: #ffd93d;">{{ "{:,}".format(total_sales) }}ì›</p>
    </div>
    <div class="card" style="flex: 1; min-width: 150px; text-align: center;">
        <h4 style="margin: 0; color: #888; font-size: 0.9em;">ì „ì²´ ìˆœì´ìµ</h4>
        <p style="font-size: 1.5em; margin: 10px 0; color: #6BCB77;">{{ "{:,}".format(total_profit) }}ì›</p>
    </div>
</div>

<!-- ê²€ìƒ‰ -->
<div class="card">
    <h3>íšŒì› ê²€ìƒ‰</h3>
    <form method="get" action="{{ url_for('admin_dashboard') }}" style="display: flex; gap: 10px;">
        <input type="text" name="search" value="{{ search }}" placeholder="ì´ë¦„ ë˜ëŠ” ì´ë©”ì¼ë¡œ ê²€ìƒ‰..." style="flex: 1; padding: 10px; border: 1px solid #444; border-radius: 5px; background: #2a2a2a; color: white;">
        <button type="submit" class="btn btn-primary">ê²€ìƒ‰</button>
        {% if search %}
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">ì´ˆê¸°í™”</a>
        {% endif %}
    </form>
</div>

<!-- íšŒì› ëª©ë¡ -->
<div class="card mt-4">
    <h3>íšŒì› ëª©ë¡ {% if search %}(ê²€ìƒ‰: "{{ search }}"){% endif %}</h3>
    
    {% if users %}
    <div style="overflow-x: auto;">
    <table style="width: 100%; border-collapse: collapse; min-width: 900px;">
        <thead>
            <tr style="border-bottom: 2px solid #444;">
                <th style="padding: 12px; text-align: left;">ID</th>
                <th style="padding: 12px; text-align: left;">ì´ë¦„</th>
                <th style="padding: 12px; text-align: left;">ì´ë©”ì¼</th>
                <th style="padding: 12px; text-align: center;">ê°€ì…ì¼</th>
                <th style="padding: 12px; text-align: center;">ìµœê·¼ ë¡œê·¸ì¸</th>
                <th style="padding: 12px; text-align: right;">ì§€ì¶œ</th>
                <th style="padding: 12px; text-align: right;">ë§¤ì¶œ</th>
                <th style="padding: 12px; text-align: right;">ìˆœì´ìµ</th>
                <th style="padding: 12px; text-align: center;">ê´€ë¦¬</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr style="border-bottom: 1px solid #333;">
                <td style="padding: 12px;">{{ user.id }}</td>
                <td style="padding: 12px;">{{ user.username }}</td>
                <td style="padding: 12px; color: #888; font-size: 0.9em;">{{ user.email }}</td>
                <td style="padding: 12px; text-align: center; color: #888; font-size: 0.85em;">
                    {% if user.created_at %}
                    {{ user.created_at.strftime('%Y-%m-%d') }}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td style="padding: 12px; text-align: center; color: #888; font-size: 0.85em;">
                    {% if user.last_login %}
                    {{ user.last_login.strftime('%Y-%m-%d %H:%M') }}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td style="padding: 12px; text-align: right; color: #ff6b6b;">{{ "{:,}".format(user.expense) }}</td>
                <td style="padding: 12px; text-align: right; color: #ffd93d;">{{ "{:,}".format(user.sales) }}</td>
                <td style="padding: 12px; text-align: right; color: {% if user.profit >= 0 %}#6BCB77{% else %}#ff6b6b{% endif %};">{{ "{:,}".format(user.profit) }}</td>
                <td style="padding: 12px; text-align: center;">
                    <a href="{{ url_for('admin_user_detail', user_id=user.id) }}" class="btn btn-sm btn-info">ìƒì„¸</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    
    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    {% if pagination.pages > 1 %}
    <div style="margin-top: 20px; text-align: center;">
        {% if pagination.has_prev %}
        <a href="{{ url_for('admin_dashboard', page=pagination.prev_num, search=search) }}" class="btn btn-sm btn-secondary">ì´ì „</a>
        {% endif %}
        
        <span style="margin: 0 15px; color: #888;">
            {{ pagination.page }} / {{ pagination.pages }} í˜ì´ì§€
        </span>
        
        {% if pagination.has_next %}
        <a href="{{ url_for('admin_dashboard', page=pagination.next_num, search=search) }}" class="btn btn-sm btn-secondary">ë‹¤ìŒ</a>
        {% endif %}
    </div>
    {% endif %}
    
    {% else %}
    <p style="color: #888; text-align: center; padding: 20px;">
        {% if search %}
        "{{ search }}" ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
        {% else %}
        ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.
        {% endif %}
    </p>
    {% endif %}
</div>
{% endblock %}