{% extends "layout.html" %}

{% block title %}회원가입{% endblock %}

{% block content %}
<div class="auth-container" style="max-width: 400px; margin: 50px auto; display: flex; flex-direction: column; align-items: center;">
    <div class="card" style="width: 100%; text-align: center;">
        <h2>회원가입</h2>
        <form method="POST" action="{{ url_for('register') }}" id="register-form" style="text-align: left; width: 100%; max-width: 350px; margin: 0 auto;">
            <div class="form-group">
                <label for="username">아이디</label>
                <input type="text" class="form-control" id="username" name="username" required
                       pattern="[A-Za-z0-9]+" 
                       title="아이디는 영문자와 숫자만 사용 가능합니다.">
                <small class="form-text text-muted">영문, 숫자만 사용 가능합니다.</small>
            </div>
            <div class="form-group">
                <label for="email">이메일</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            
            <div class="form-group">
                <label for="full_name">이름</label>
                <input type="text" class="form-control" id="full_name" name="full_name" required
                       pattern="[가-힣]+"
                       title="이름은 한글만 입력 가능합니다.">
                <small class="form-text text-muted">한글만 사용 가능합니다 (예: 홍길동).</small>
            </div>
            
            <div class="form-group">
                <label for="dob-display">생년월일</label>
                <input type="text" class="form-control" id="dob-display" placeholder="날짜를 선택하세요" readonly required style="cursor: pointer;">
                <input type="hidden" id="dob" name="dob">
            </div>

            <div class="form-group">
                <label for="phone">연락처</label>
                <input type="tel" class="form-control" id="phone" name="phone" required
                       pattern="010-[0-9]{4}-[0-9]{4}"
                       placeholder="010-0000-0000"
                       title="연락처는 010-0000-0000 형식으로 입력해주세요.">
                <small class="form-text text-muted">하이픈(-)을 포함하여 입력해주세요.</small>
            </div>

            <div class="form-group">
                <label for="password">비밀번호</label>
                <input type="password" class="form-control" id="password" name="password" required
                       minlength="8"
                       maxlength="20"
                       pattern="[A-Za-z0-9]{8,20}"
                       title="비밀번호는 8~20자리의 영문자와 숫자만 사용 가능합니다.">
                <small class="form-text text-muted">8~20자리의 영문, 숫자만 사용 가능합니다.</small>
            </div>
            <div style="text-align: center;">
                <button type="submit" class="btn btn-primary signup-btn" style="width: 100%; box-sizing: border-box;">가입하기</button>
            </div>
        </form>
        <p class="mt-4" style="text-align: center;">
            이미 계정이 있으신가요? <a href="{{ url_for('login') }}" class="login-link">로그인</a>
        </p>
    </div>
</div>

<div id="datepicker-modal" class="datepicker-modal-container">
    <div class="datepicker-content">
        <div class="datepicker-header">
            <button type="button" class="datepicker-nav" id="prev-month">&lt;</button>
            <div class="datepicker-month-year">
                <select id="year-select"></select>
                <select id="month-select"></select>
            </div>
            <button type="button" class="datepicker-nav" id="next-month">&gt;</button>
        </div>
        <div class="datepicker-body">
            <div class="datepicker-days-header">
                <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
            </div>
            <div class="datepicker-days" id="datepicker-days"></div>
        </div>
        <button type="button" id="close-datepicker" class="btn btn-secondary" style="margin-top: 15px;">닫기</button>
    </div>
</div>


<style>
/* ... (기존 스타일) ... */
.form-text.text-muted { display: block; margin-top: 5px; font-size: 0.85em; color: #a0a0a0; }
input:invalid { border-color: #dc3545; }
input:valid { border-color: #28a745; }

.datepicker-modal-container { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
.datepicker-content { background-color: var(--card-bg); padding: 25px; border-radius: 12px; width: 90%; max-width: 340px; text-align: center; border: 1px solid var(--border-color); }
.datepicker-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.datepicker-nav { background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; }

.datepicker-month-year select {
    background-color: #3e3e3e;
    color: white;
    border: 1px solid #555;
    padding: 5px 8px;
    border-radius: 4px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
}

.datepicker-body { }
.datepicker-days-header, .datepicker-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
.datepicker-days-header div { font-weight: bold; color: var(--text-muted); padding-bottom: 10px; }
.datepicker-day { padding: 8px 0; cursor: pointer; border-radius: 50%; transition: background-color 0.2s; }
.datepicker-day:hover { background-color: #444; }
.datepicker-day.empty { cursor: default; }
.datepicker-day.empty:hover { background: none; }
.datepicker-day.selected { background-color: var(--active-color); color: white; font-weight: bold; }

/* ⭐️⭐️⭐️ 로그인 링크 스타일 수정 ⭐️⭐️⭐️ */
.login-link {
    color: #38b6ff !important; /* 더 밝은 파란색으로 변경 */
    text-decoration: none !important;
    font-weight: 600 !important;
    transition: color 0.2s;
}

.login-link:hover {
    color: #ffffff !important;
    text-decoration: underline !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('register-form');
    function validateInput(input) {
        if (input.checkValidity()) input.style.borderColor = '#28a745';
        else input.style.borderColor = '#dc3545';
    }
    ['username', 'password', 'full_name', 'phone'].forEach(id => {
        const el = document.getElementById(id);
        if(el) el.addEventListener('input', () => validateInput(el));
    });
    
    const dobDisplay = document.getElementById('dob-display');
    const dobInput = document.getElementById('dob');
    const modal = document.getElementById('datepicker-modal');
    const yearSelect = document.getElementById('year-select');
    const monthSelect = document.getElementById('month-select');
    const daysEl = document.getElementById('datepicker-days');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');
    const closeBtn = document.getElementById('close-datepicker');

    let currentDate = new Date();

    const currentYear = new Date().getFullYear();
    for (let i = currentYear; i >= currentYear - 100; i--) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${i}년`;
        yearSelect.appendChild(option);
    }

    for (let i = 0; i < 12; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${i + 1}월`;
        monthSelect.appendChild(option);
    }

    function renderCalendar(year, month) {
        yearSelect.value = year;
        monthSelect.value = month;
        daysEl.innerHTML = '';
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
            daysEl.innerHTML += `<div class="datepicker-day empty"></div>`;
        }

        for (let i = 1; i <= daysInMonth; i++) {
            const dayEl = document.createElement('div');
            dayEl.className = 'datepicker-day';
            dayEl.textContent = i;
            dayEl.dataset.date = new Date(year, month, i, 9).toISOString().split('T')[0];
            
            if (dobInput.value === dayEl.dataset.date) {
                dayEl.classList.add('selected');
            }

            dayEl.addEventListener('click', () => {
                dobInput.value = dayEl.dataset.date;
                dobDisplay.value = dayEl.dataset.date;
                modal.style.display = 'none';
                validateInput(dobDisplay);
            });
            daysEl.appendChild(dayEl);
        }
    }
    
    function updateCalendarFromSelect() {
        currentDate = new Date(yearSelect.value, monthSelect.value, 1);
        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
    }

    yearSelect.addEventListener('change', updateCalendarFromSelect);
    monthSelect.addEventListener('change', updateCalendarFromSelect);

    dobDisplay.addEventListener('click', () => {
        modal.style.display = 'flex';
        const initialDate = dobInput.value ? new Date(dobInput.value) : new Date();
        currentDate = new Date(initialDate.getFullYear(), initialDate.getMonth(), 1);
        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });

    prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });

    nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });
    
    closeBtn.addEventListener('click', () => modal.style.display = 'none');
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.style.display = 'none';
    });
    
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            alert('입력 양식을 다시 확인해주세요.');
        }
    });
});
</script>
{% endblock %}

